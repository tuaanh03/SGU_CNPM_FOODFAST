â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”´ Sá»¬A Lá»–I "ENOTFOUND api-gateway" - ORDER SERVICE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## âŒ Lá»–I Báº N ÄANG Gáº¶P

```
Error placing order: Error: Cart Service error: getaddrinfo ENOTFOUND api-gateway
Request: POST /api/order/create-from-cart
Status: 400 Bad Request
```

## ğŸ› NGUYÃŠN NHÃ‚N

Order Service Ä‘ang hardcode URL `http://api-gateway:3000` (tÃªn Docker container) trong code:

**Vá»‹ trÃ­ lá»—i:**
1. `order-service/src/utils/cartHelper.ts` - Gá»i Cart Service
2. `order-service/src/controllers/order.ts` - Gá»i Product Service

â†’ TrÃªn Railway: KhÃ´ng cÃ³ container tÃªn "api-gateway"
â†’ DNS resolution failed: ENOTFOUND

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## âœ… ÄÃƒ Sá»¬A
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### 1. Code Changes

**File: `order-service/src/utils/cartHelper.ts`**
```typescript
// THÃŠM biáº¿n mÃ´i trÆ°á»ng
const API_GATEWAY_URL = process.env.API_GATEWAY_URL || 'http://api-gateway:3000';

// Sá»¬A tá»« hardcode â†’ biáº¿n
`${API_GATEWAY_URL}/api/cart/${storeId}`
```

**File: `order-service/src/controllers/order.ts`**
```typescript
// THÃŠM biáº¿n mÃ´i trÆ°á»ng
const API_GATEWAY_URL = process.env.API_GATEWAY_URL || 'http://api-gateway:3000';

// Sá»¬A tá»« hardcode â†’ biáº¿n
`${API_GATEWAY_URL}/api/products/${item.productId}`
```

**File: `order-service/.env`**
```env
# THÃŠM biáº¿n má»›i
API_GATEWAY_URL=http://api-gateway:3000  # Docker local
```

### 2. Logging Improvements

- âœ… ThÃªm console.log Ä‘á»ƒ debug API_GATEWAY_URL
- âœ… Improved error messages
- âœ… Success logs khi clear cart

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸš€ Cáº¤U HÃŒNH TRÃŠN RAILWAY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### BÆ¯á»šC 1: ThÃªm biáº¿n mÃ´i trÆ°á»ng cho Order Service

VÃ o Order Service trÃªn Railway â†’ Variables tab

**THÃŠM biáº¿n má»›i:**
```
API_GATEWAY_URL=https://api-gateway-service-production-04a1.up.railway.app
```

âš ï¸ **LÆ¯U Ã:**
- KhÃ´ng cÃ³ `/` á»Ÿ cuá»‘i URL
- Pháº£i lÃ  HTTPS (Railway public URL)
- URL chÃ­nh xÃ¡c cá»§a API Gateway service cá»§a báº¡n

### BÆ¯á»šC 2: Kiá»ƒm tra cÃ¡c biáº¿n khÃ¡c

**Order Service cáº§n táº¥t cáº£ cÃ¡c biáº¿n:**
```
# API Gateway
API_GATEWAY_URL=https://api-gateway-service-production-04a1.up.railway.app

# Database
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Redis
REDIS_HOST=${{Redis.REDISHOST}}
REDIS_PORT=${{Redis.REDISPORT}}
REDIS_PASSWORD=${{Redis.REDISPASSWORD}}
REDIS_DB=0
ORDER_SESSION_DURATION_MINUTES=5

# Kafka (Confluent Cloud)
KAFKA_BROKERS=<your-cluster>.confluent.cloud:9092
KAFKA_USERNAME=<API_KEY>
KAFKA_PASSWORD=<API_SECRET>
KAFKA_SECURITY_PROTOCOL=SASL_SSL
KAFKA_SASL_MECHANISM=PLAIN

# JWT
JWT_SECRET_KEY=da2589b8d56a947a0d5f3be53b18345a144acb79dcd32f2e5e590874cebb375f

# Other
PORT=2000
NODE_ENV=production
```

### BÆ¯á»šC 3: Deploy láº¡i Order Service

### BÆ¯á»šC 4: Kiá»ƒm tra logs

**Logs thÃ nh cÃ´ng:**
```
ğŸ”§ Cart Helper Config:
  - API_GATEWAY_URL: https://api-gateway-service-production-04a1.up.railway.app
âœ… Order created successfully
âœ… Cart cleared successfully for store: <storeId>
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ³ DOCKER-COMPOSE (LOCAL) - KHÃ”NG áº¢NH HÆ¯á»NG
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

File `.env` local:
```env
API_GATEWAY_URL=http://api-gateway:3000
```

- âœ… Docker network resolution hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
- âœ… KhÃ´ng cáº§n thay Ä‘á»•i gÃ¬
- âœ… `docker-compose up` váº«n cháº¡y nhÆ° cÅ©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ” KIá»‚M TRA Lá»–I CÅ¨ ÄÃƒ ÄÆ¯á»¢C Sá»¬A CHÆ¯A
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### Test Flow: Táº¡o Order tá»« Cart

**1. ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng**
```bash
POST /api/cart/add
Authorization: Bearer <token>
{
  "productId": "xxx",
  "quantity": 2,
  "storeId": "yyy"
}
```

**2. Táº¡o order tá»« cart**
```bash
POST /api/order/create-from-cart
Authorization: Bearer <token>
{
  "storeId": "yyy",
  "deliveryAddress": "123 Main St",
  "contactPhone": "0123456789",
  "note": "No onions please"
}
```

**TRÆ¯á»šC (Lá»—i):**
```
âŒ Status: 400
âŒ Error: Cart Service error: getaddrinfo ENOTFOUND api-gateway
```

**SAU (ThÃ nh cÃ´ng):**
```
âœ… Status: 201
âœ… Response: {
  "success": true,
  "message": "Order created successfully",
  "data": {
    "id": "order_xxx",
    "userId": "user_yyy",
    "status": "PENDING_PAYMENT",
    "totalPrice": 50000,
    ...
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ› TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### Lá»—i: "ENOTFOUND api-gateway"
âœ… ÄÃƒ Sá»¬A: Set API_GATEWAY_URL trÃªn Railway

### Lá»—i: "Network request failed"
â†’ API_GATEWAY_URL sai hoáº·c API Gateway service down
â†’ Kiá»ƒm tra API Gateway cÃ³ Ä‘ang cháº¡y khÃ´ng

### Lá»—i: "Cart is empty"
â†’ Giá» hÃ ng thá»±c sá»± trá»‘ng hoáº·c storeId sai
â†’ ThÃªm sáº£n pháº©m vÃ o cart trÆ°á»›c khi táº¡o order

### Lá»—i: "Product not found"
â†’ ProductId trong cart khÃ´ng tá»“n táº¡i
â†’ Kiá»ƒm tra Product Service

### Lá»—i: "Unauthorized"
â†’ JWT token háº¿t háº¡n hoáº·c khÃ´ng há»£p lá»‡
â†’ Login láº¡i Ä‘á»ƒ láº¥y token má»›i

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ“‹ CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TrÃªn Railway Order Service:

â–¡ ThÃªm: API_GATEWAY_URL=https://api-gateway-service-production-04a1.up.railway.app
â–¡ Kiá»ƒm tra cÃ¡c biáº¿n khÃ¡c (Database, Redis, Kafka)
â–¡ Deploy láº¡i Order Service
â–¡ Kiá»ƒm tra logs: "Cart Helper Config"
â–¡ Test: ThÃªm sáº£n pháº©m vÃ o cart
â–¡ Test: Táº¡o order tá»« cart
â–¡ Verify: Order created successfully (Status 201)
â–¡ Verify: Cart cleared after order creation

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ¯ TÃ“M Táº®T
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**Váº¥n Ä‘á»:** Order Service hardcode `http://api-gateway:3000`
**Giáº£i phÃ¡p:** DÃ¹ng biáº¿n `API_GATEWAY_URL` tá»« env

**Files Ä‘Ã£ sá»­a:**
1. order-service/src/utils/cartHelper.ts âœ…
2. order-service/src/controllers/order.ts âœ…
3. order-service/.env âœ…

**Railway config:**
- ThÃªm biáº¿n: `API_GATEWAY_URL=https://api-gateway-service-production-04a1.up.railway.app`
- Deploy láº¡i Order Service
- Test create order tá»« cart

**Docker local:** KhÃ´ng áº£nh hÆ°á»Ÿng, váº«n dÃ¹ng `http://api-gateway:3000`

