â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Cáº¤U HÃŒNH VNPAY URL - HOÃ€N Táº¤T
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ğŸ“‹ ÄÃƒ THá»°C HIá»†N

âœ… Cáº­p nháº­t vnpay.ts - Linh hoáº¡t RETURN_URL theo mÃ´i trÆ°á»ng
âœ… Cáº­p nháº­t .env - HÆ°á»›ng dáº«n cho Docker/Railway/Vercel
âœ… Táº¡o .env.example - Template Ä‘áº§y Ä‘á»§
âœ… Táº¡o VNPAY_URL_CONFIG.txt - HÆ°á»›ng dáº«n chi tiáº¿t
âœ… ThÃªm route /payment-result vÃ o frontend
âœ… Frontend Ä‘Ã£ cÃ³ PaymentResultPage xá»­ lÃ½ káº¿t quáº£

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ¯ Cáº¤U HÃŒNH CHO PRODUCTION (VERCEL)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### **BÆ°á»›c 1: Railway - Payment Service**

VÃ o Railway Dashboard â†’ Payment Service â†’ Variables

ThÃªm/Cáº­p nháº­t:
```
VNPAY_RETURN_URL=https://sgu-cnpm-foodfast.vercel.app/payment-result
FRONTEND_URL=https://sgu-cnpm-foodfast.vercel.app
```

Redeploy payment service

### **BÆ°á»›c 2: âš ï¸ QUAN TRá»ŒNG - VNPay Sandbox Portal**

1. VÃ o: https://sandbox.vnpayment.vn/merchantv2/
2. Login vá»›i tÃ i khoáº£n merchant (TMN Code: X8XUBJ2R)
3. VÃ o: **Cáº¥u hÃ¬nh** â†’ **URL IPN**
4. Nháº­p:
   ```
   https://api-gateway-service-production-04a1.up.railway.app/api/payments/vnpay_ipn
   ```
5. **LÆ¯U Láº I**

### **BÆ°á»›c 3: Test**

1. Deploy frontend lÃªn Vercel
2. Táº¡o Ä‘Æ¡n hÃ ng â†’ Thanh toÃ¡n
3. Kiá»ƒm tra:
   - VNPay redirect vá»: `https://sgu-cnpm-foodfast.vercel.app/payment-result?...`
   - Log payment service nháº­n IPN
   - Order status Ä‘Æ°á»£c update

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ³ Cáº¤U HÃŒNH CHO DOCKER-COMPOSE (NGROK)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### **BÆ°á»›c 1: Cháº¡y ngrok**
```bash
ngrok http 3000
```

VÃ­ dá»¥ output: `https://abc-xyz-123.ngrok-free.dev`

### **BÆ°á»›c 2: Cáº­p nháº­t .env trong payment-service**
```env
VNPAY_RETURN_URL=https://abc-xyz-123.ngrok-free.dev/payment-result
VNPAY_IPN_URL=https://abc-xyz-123.ngrok-free.dev/api/payments/vnpay_ipn
FRONTEND_URL=http://localhost:3000
```

### **BÆ°á»›c 3: Cáº­p nháº­t VNPay Portal IPN URL**
```
https://abc-xyz-123.ngrok-free.dev/api/payments/vnpay_ipn
```

### **BÆ°á»›c 4: Restart docker-compose**
```bash
docker-compose down
docker-compose up -d --build payment-service
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## â“ CÃ‚U Há»I: CÃ“ Cáº¦N Cáº¤U HÃŒNH IPN URL TRONG VNPAY PORTAL?
â”â”ï¿½ï¿½â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**âœ… CÃ“, Báº®T BUá»˜C!**

IPN URL **PHáº¢I** Ä‘Æ°á»£c config trong VNPay Merchant Portal vÃ¬:
- ThÆ° viá»‡n vnpay khÃ´ng cho phÃ©p truyá»n IPN URL qua API
- VNPay sáº½ gá»­i server-to-server notification Ä‘áº¿n URL nÃ y
- Náº¿u khÃ´ng config, payment sáº½ thÃ nh cÃ´ng nhÆ°ng order khÃ´ng update

**Return URL**: KhÃ´ng cáº§n config trong portal, Ä‘Æ°á»£c truyá»n qua API

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ”„ LUá»’NG HOáº T Äá»˜NG
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### **Khi User thanh toÃ¡n thÃ nh cÃ´ng:**

1ï¸âƒ£ VNPay redirect user â†’ `VNPAY_RETURN_URL`
   - Production: `https://sgu-cnpm-foodfast.vercel.app/payment-result?status=success&...`
   - Docker: `https://your-ngrok.ngrok-free.dev/payment-result?status=success&...`
   - Frontend hiá»ƒn thá»‹ káº¿t quáº£

2ï¸âƒ£ VNPay gá»­i IPN (background) â†’ API Gateway â†’ Payment Service
   - Production: `https://api-gateway-service-production-04a1.up.railway.app/api/payments/vnpay_ipn`
   - Docker: `https://your-ngrok.ngrok-free.dev/api/payments/vnpay_ipn`
   - Payment service: Verify â†’ Update DB â†’ Kafka event â†’ Order service update

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ“ FILES ÄÃƒ CHá»ˆNH Sá»¬A
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… backend/services/payment-service/src/utils/vnpay.ts
   â†’ Linh hoáº¡t RETURN_URL

âœ… backend/services/payment-service/.env
   â†’ Cáº­p nháº­t comment vÃ  config

âœ… backend/services/payment-service/.env.example
   â†’ Template cho má»i mÃ´i trÆ°á»ng

âœ… backend/services/payment-service/VNPAY_URL_CONFIG.txt
   â†’ HÆ°á»›ng dáº«n chi tiáº¿t Ä‘áº§y Ä‘á»§

âœ… frontend/cnpm-fooddelivery/src/App.tsx
   â†’ ThÃªm route /payment-result

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
## ğŸ‰ HOÃ€N Táº¤T
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Code linh hoáº¡t cho cáº£ Docker/Railway/Vercel
âœ… Frontend cÃ³ route /payment-result
âœ… HÆ°á»›ng dáº«n Ä‘áº§y Ä‘á»§ trong VNPAY_URL_CONFIG.txt
âœ… Chá»‰ cáº§n update biáº¿n mÃ´i trÆ°á»ng khi deploy

**Báº®T Äáº¦U DEPLOY:**
1. Set biáº¿n trÃªn Railway
2. Config IPN URL trong VNPay Portal
3. Deploy & Test!

