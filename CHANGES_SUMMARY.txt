## ğŸ”§ NHá»®NG THAY Äá»”I ÄÃƒ THá»°C HIá»†N

### Váº¤N Äá»€ Gá»C:
- Frontend trÃªn Railway gá»i API vá»›i URL `undefined` â†’ Network Error
- NguyÃªn nhÃ¢n: Vite khÃ´ng nhÃºng `VITE_API_BASE_URL` vÃ o bundle vÃ¬ khÃ´ng Ä‘Æ°á»£c set khi build

---

### CÃC FILE ÄÃƒ Sá»¬A:

#### 1. `frontend/cnpm-fooddelivery/Dockerfile`
**Thay Ä‘á»•i:**
- âœ… ThÃªm `ARG VITE_API_BASE_URL=/api` vÃ  `ENV` Ä‘á»ƒ inject vÃ o build
- âœ… TÃ¡ch logic chá»n nginx config dá»±a vÃ o `USE_HTTPS`
- âœ… Copy 2 templates: `.railway` (HTTPS) vÃ  `.local` (HTTP)

**Káº¿t quáº£:**
- Local: DÃ¹ng HTTP config, proxy tá»›i `http://api-gateway:3000`
- Railway: DÃ¹ng HTTPS config, proxy tá»›i `https://xxx.railway.app`

#### 2. `frontend/cnpm-fooddelivery/nginx.conf.template`
**Thay Ä‘á»•i:**
- âœ… Äá»•i `proxy_pass` tá»« HTTP sang HTTPS
- âœ… ThÃªm SSL config: `proxy_ssl_verify off`, `proxy_ssl_server_name on`
- âœ… TÄƒng timeout lÃªn 120s
- âœ… Sá»­a Host header thÃ nh `${API_GATEWAY_HOST}`

**Káº¿t quáº£:**
- Káº¿t ná»‘i Ä‘Æ°á»£c vá»›i Railway API Gateway qua HTTPS

#### 3. `frontend/cnpm-fooddelivery/nginx.conf.template.local` (Má»šI)
**Ná»™i dung:**
- HTTP config cho local Docker
- Proxy tá»›i `http://${API_GATEWAY_HOST}`
- Timeout 120s

#### 4. `frontend/cnpm-fooddelivery/src/config/api.ts`
**Thay Ä‘á»•i:**
- âœ… XÃ³a function `getApiUrl()` gÃ¢y lá»—i (khÃ´ng ai dÃ¹ng)
- âœ… ÄÆ¡n giáº£n hÃ³a code
- âœ… ThÃªm log debug cho dev mode

**Káº¿t quáº£:**
- Code sáº¡ch hÆ¡n, dá»… debug

#### 5. `frontend/admin-dashboard/Dockerfile`
**Thay Ä‘á»•i:**
- âœ… ThÃªm `ARG VITE_API_BASE_URL=/api`

#### 6. `frontend/restaurant-merchant/Dockerfile`
**Thay Ä‘á»•i:**
- âœ… ThÃªm `ARG VITE_API_BASE_URL=/api`

#### 7. `docker-compose.yml`
**Thay Ä‘á»•i:**
- âœ… ThÃªm `build.args.VITE_API_BASE_URL: /api`
- âœ… ThÃªm `environment.USE_HTTPS=false`
- âœ… Giá»¯ nguyÃªn `API_GATEWAY_HOST=api-gateway:3000`

**Káº¿t quáº£:**
- Local build vÃ  cháº¡y Ä‘Ãºng vá»›i HTTP

---

### FILES Má»šI Táº O:

1. **DEPLOYMENT_GUIDE.txt**
   - HÆ°á»›ng dáº«n chi tiáº¿t deploy local vÃ  Railway
   - Troubleshooting
   - Checklist

2. **FIX_NETWORK_ERROR.md**
   - Giáº£i thÃ­ch ngáº¯n gá»n vá» fix
   - HÆ°á»›ng dáº«n config Railway

3. **RAILWAY_CONFIG_GUIDE.txt**
   - HÆ°á»›ng dáº«n cáº¥u hÃ¬nh Railway environment variables

---

## âœ… Káº¾T QUáº¢:

### Local (docker-compose):
```bash
docker-compose up -d --build
```
- Frontend build vá»›i `VITE_API_BASE_URL=/api`
- Nginx dÃ¹ng HTTP config
- Proxy tá»›i `http://api-gateway:3000`
- âœ… HOáº T Äá»˜NG BÃŒNH THÆ¯á»œNG

### Railway:
Environment Variables cáº§n set:
```
USE_HTTPS=true
API_GATEWAY_HOST=api-gateway-xxx.up.railway.app
```

- Frontend build vá»›i `VITE_API_BASE_URL=/api`
- Nginx dÃ¹ng HTTPS config
- Proxy tá»›i `https://api-gateway-xxx.up.railway.app`
- âœ… Káº¾T Ná»I THÃ€NH CÃ”NG

---

## ğŸ¯ CÃCH Sá»¬ Dá»¤NG:

### Khi cháº¡y Local:
```bash
# KhÃ´ng cáº§n lÃ m gÃ¬ thÃªm, chá»‰ cáº§n:
docker-compose up -d --build
```

### Khi deploy Railway:
1. Set env vars cho frontend service:
   ```
   USE_HTTPS=true
   API_GATEWAY_HOST=<api-gateway-domain>
   ```
2. Push code lÃªn Git
3. Railway tá»± Ä‘á»™ng deploy
4. Xong!

---

## ğŸ” DEBUG:

### Kiá»ƒm tra build cÃ³ inject VITE_API_BASE_URL:
```bash
# Local
docker exec frontend sh -c "grep -r 'API_BASE_URL' /usr/share/nginx/html/assets/*.js | head -1"
# Pháº£i tháº¥y: "/api" chá»© KHÃ”NG pháº£i undefined
```

### Kiá»ƒm tra nginx config:
```bash
# Local
docker exec frontend cat /etc/nginx/conf.d/default.conf | grep proxy_pass
# Pháº£i tháº¥y: http://api-gateway:3000

# Railway Shell
cat /etc/nginx/conf.d/default.conf | grep proxy_pass
# Pháº£i tháº¥y: https://xxx.railway.app
```

---

## âš ï¸ LÆ¯U Ã:

1. **ARG vs ENV trong Dockerfile:**
   - `ARG`: Chá»‰ available khi build
   - `ENV`: Available cáº£ build vÃ  runtime
   - Cáº§n cáº£ 2: ARG Ä‘á»ƒ override, ENV Ä‘á»ƒ set giÃ¡ trá»‹

2. **VITE biáº¿n mÃ´i trÆ°á»ng:**
   - Chá»‰ inject vÃ o bundle khi BUILD
   - Runtime khÃ´ng thá»ƒ thay Ä‘á»•i (khÃ¡c Node.js)
   - Pháº£i rebuild Ä‘á»ƒ thay Ä‘á»•i

3. **Nginx template substitution:**
   - `envsubst` chá»‰ thay tháº¿ lÃºc container start
   - Cáº§n dÃ¹ng `${VARIABLE}` syntax
   - KhÃ´ng dÃ¹ng Ä‘Æ°á»£c cho static nginx.conf

4. **Railway:**
   - Env vars máº¥t 1-2 phÃºt Ä‘á»ƒ apply
   - Má»—i láº§n thay Ä‘á»•i env pháº£i redeploy
   - Services cÃ³ thá»ƒ sleep sau vÃ i phÃºt khÃ´ng dÃ¹ng

